<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    
    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Vega WebRTC</title>
    
    <link href="/stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,800,700,600,300' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,300,100,700' rel='stylesheet' type='text/css'>
  </head>
  
  <body class="try-it">
    <header class="centered-navigation">
      <div class="centered-navigation-wrapper">
        <a href="javascript:void(0)" class="mobile-logo">
          <img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/placeholder_logo_3_dark.png" alt="Logo image">
        </a>
        <a href="" class="centered-navigation-menu-button">MENU</a>
        <ul class="centered-navigation-menu">
          <li class="nav-link"><a href="/">Vega WebRTC</a></li>
          <li class="nav-link"><a href="/try-it.html">Try it!</a></li>
          <li class="nav-link"><a href="/guides.html">Guides</a></li>
          <li class="nav-link"><a href="/docs.html">Documentation</a></li>
        </ul>
      </div>
    </header>

    <article class="type-system-sans">
  <p class="type">It's too easy</p>

  <h1>Make a video chat app in 5 minutes!</h1>

  <h2>Introduction</h2>

  <p>For this, you'll need:</p>

  <p>
    <ul>
      <li><a href="http://git-scm.com/">Git</a></li>
      <li><a href="https://www.ruby-lang.org/en/">Ruby</a></li>
      <li><a href="http://bundler.io/">Bundler</a></li>
      <li><a href="http://middlemanapp.com/">Middleman</a></li>
      <li>Internet connectivity</li>
      <li>WebRTC compliant browser (Chrome or Firefox)</li>
    </ul>
  </p>

  <p>
    We'll make our video chat application in four steps:
    <ol>
      <li>Step 1: Start a Vega Server</li>
      <li>Step 2: Initiate a Middleman app</li>
      <li>Step 3: Show your local video</li>
      <li>Step 4: Handle your peers</li>
    </ol>
  </p>

  <hr>
  <h2>Step 1: Start a Vega Server</h2>
  <p>
    We need a Vega Server to handle some initial communication between peers.
  </p>
  <ol>
    <li>
      <p>First clone the vega server example repo:</p>

      <p>
        <pre>
          $ git clone git@github.com:vega-webrtc/vega_server_ruby_example.git && cd vega_server_ruby_example
        </pre>
      </p>
    </li>
    <li>
      <p>Then, install the dependencies:</p>

      <p>
        <pre>
          $ bundle install
        </pre>
      <p>
    </li>
    <li>
      <p>Finally, run the server:</p>

      <pre>
        $ bundle exec puma example.ru -p 9292
      </pre>
    </li>
  </ol>

  <p>
    Now we can move to the browser. Let's get the user media and display it if
    the user allows their stream to be shared.
  </p>

  <h2>Step 2: Initiate a Middleman app</h2>
  <p>
    We need a local server to serve our video application. We'll init a
    Middleman app, clear out the predefined index.html.erb file, and serve up
    the app.
  </p>
  <pre>
    $ middleman init video-chat
    $ cd video-chat
    $ echo "" > source/index.html.erb
    $ middleman server -p 4500
  </pre>

  <p>
    Surf over to <code>localhost:4500</code> in your browser and you should see a blank, gray screen.
  </p>

  <p>Now include the Vega Prime bundle and JQueryin your javascript source code with <code>wget</code>.</p>

  <pre>
    $ wget https://raw.githubusercontent.com/vega-webrtc/vega-prime/master/vega-prime.bundle.js -O source/javascripts/vega-prime.bundle.js
    $ wget http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js -O source/javascripts/jquery.min.js
  </pre>

  <h2>Step 3: Show your local video</h2>

  <p>Let's setup our index.html.erb file to have a video tag for our camera.</p>

  <pre>
    # source/index.html.erb

    &#60;video id="me" muted autoplay style="width: 25%;"&#62;&#60;/video&#62;
  </pre>

  <p>Finally, let's use Vega Prime to get our video in there.</p>

  <pre>
    # source/index.html.erb

    &#60;video id="me" muted autoplay style="width: 25%;"&#62;&#60;/video&#62;

    &#60;script&#62;
      new VegaPrime({
        url: 'ws://localhost:9292', 
        badge: {},
        roomId: '/fun',
      }).onLocalStreamReceived(function(wrappedStream){
        $('video#me').attr('src', wrappedStream.url);
      })
    &#60;/script&#62;
  </pre>

  <p>
    Then allow the browser to access your camera and microphone, and you should
    see yourself pointed right back at ya!
  </p>

  <h2>Step 4: Handle your peers</h2>
  <p>
    Now we need to display peers when they arrive, and remove them when they go away.
  </p>

  <p>
    First, let's create a little space for our friends to go.
  </p>

  <pre>
    # source/index.html.erb

    &#60;div id="peers"&#62;&#60;/div&#62;

    &#60;video id="me" muted autoplay style="width: 25%;"&#62;&#60;/video&#62;

    &#60;script&#62;
      new VegaPrime({
        url: 'ws://localhost:9292', 
        badge: {},
        roomId: '/fun',
      }).onLocalStreamReceived(function(wrappedStream){
        $('video#me').attr('src', wrappedStream.url);
      })
    &#60;/script&#62;
  </pre>

  <p>
    Now, let's add our friends to the page when Vega Prime detects them.
  </p>

  <pre>
    # source/index.html.erb

    &#60;div id="peers"&#62;&#60;/div&#62;

    &#60;video id="me" muted autoplay style="width: 25%;"&#62;&#60;/video&#62;

    &#60;script&#62;
      new VegaPrime({
        url: 'ws://localhost:9292', 
        badge: {},
        roomId: '/fun',
      }).onLocalStreamReceived(function(wrappedStream){
        $('video#me').attr('src', wrappedStream.url);
      }).onStreamAdded(function(peer){
        $video = $('&#60;video autoplay style="width: 50%;"&#62');
        $video.attr('src', peer.streamUrl);
        $video.attr('data-peer-id', peer.peerId);

        $('#peers').append($video)
      })
    &#60;/script&#62;
  </pre>

  <p>
    Now refresh your browser. Then open up localhost:4500 in another tab. In both tabs, you should see a bigger
    version of yourself above yourself. That's you, but <em>through a
    peer-to-peer connection</em> going <em>through the internet</em>! Pretty
    cool, huh? Go ahead, open up localhost:4500 in yet another tab. AHH another big version of you.
    Multiple peer connections for free. WEEEEEE!
  </p>

  <p>There's one more thing we have to do. We have to remove our friends when they go away. (<em>single tear</em>)</p>

  <pre>
    # source/index.html.erb

    &#60;div id="peers"&#62;&#60;/div&#62;

    &#60;video id="me" muted autoplay style="width: 25%;"&#62;&#60;/video&#62;

    &#60;script&#62;
      new VegaPrime({
        url: 'ws://localhost:9292', 
        badge: {},
        roomId: '/fun',
      }).onLocalStreamReceived(function(wrappedStream){
        $('video#me').attr('src', wrappedStream.url);
      }).onStreamAdded(function(peer){
        $video = $('&#60;video autoplay style="width: 50%;"&#62');
        $video.attr('src', peer.streamUrl);
        $video.attr('data-peer-id', peer.peerId);

        $('#peers').append($video)
      }).onPeerRemoved(function(peer){
        $('video[data-peer-id="' + peer.peerId + '"]').remove()
      })
    &#60;/script&#62;
  </pre>

  <p>
    Now if you open up the middleman app in multiple tabs, and you close out one,
    you should see only as many versions of you as there are middleman tabs going.
  </p>

  <h2>Step 4: Profit?</h2>
  <p>
    Congratulations, you've made a very crude video chat application! Given the
    APIs above, you have a good idea of where you can take your own video
    application. Check out the guides for more on how to make your Vega Server
    secure, how to handle errors in Vega Prime, and how the whole thing works
    under the hood.
  </p>
</article>

  </body>
</html>
